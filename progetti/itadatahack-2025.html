<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ITADATAhack 2025</title>
<style>
  :root{--bg:#f5f5f7;--fg:#111;--muted:#555;--line:#ddd;--card:#fff;--soft:#eee;--code:#0b1020}
  *{box-sizing:border-box}body{margin:0;font:16px system-ui,Arial,sans-serif;background:var(--bg);color:var(--fg)}
  a{color:inherit;text-decoration:none}
  .container{max-width:900px;margin:auto;padding:16px}
  .chip{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:var(--card)}
  h1{margin:16px 0 4px}.muted{color:var(--muted)}
  .panel{background:var(--card);border:1px solid var(--soft);border-radius:12px;padding:16px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .card{border:1px solid var(--soft);border-radius:10px;padding:12px;background:var(--card)} .card h3{margin:0 0 6px}
  /* code viewer */
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .tabs{display:flex;gap:6px;flex-wrap:wrap}
  .tab{cursor:pointer}
  .tab[aria-selected="true"]{border-color:#6aa7ff}
  .btn{cursor:pointer}
  .btn,.tab,.link{padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:var(--card);display:inline-flex;align-items:center}
  .viewer{border:1px solid var(--line);border-radius:8px;background:var(--code)}
  pre{margin:0;padding:12px;color:#eee;font:13px/1.5 ui-monospace,monospace;white-space:pre-wrap;word-break:break-word;overflow:auto;max-height:220px}
  .viewer[data-collapsed="true"]{position:relative}
  .viewer[data-collapsed="true"]::after{content:"";position:absolute;inset:auto 0 0 0;height:40px;background:linear-gradient(to bottom,rgba(11,16,32,0),rgba(11,16,32,.9));pointer-events:none}
  /* PDF */
  .pdf{position:relative;border:1px solid var(--soft);border-radius:10px;overflow:hidden;background:var(--card);aspect-ratio:16/13.5}
  .pdf iframe{position:absolute;inset:0;width:100%;height:100%;border:0;display:block}
  .pdf::after{content:"";position:absolute;inset:auto 0 0 0;height:14%;background:linear-gradient(to bottom,rgba(255,255,255,0),#fff);pointer-events:none}
</style>
</head>
<body>
<main class="container">
  <a class="chip" href="../index.html" aria-label="Back to Projects">← Back to Projects</a>
  <section class="panel">
    <h1>ITADATAhack 2025</h1>
    <p class="muted">ago 2025 – set 2025</p>

    <div class="grid">
      <!-- Codes -->
      <article class="card" id="codeViewer"
        data-files='[{"label":"Task 1.py","src":"../assets/codici/Task 1.py"},{"label":"Task 2.py","src":"../assets/codici/Task 2.py"}]'>
        <h3>Codes</h3>
        <p class="muted">Select the file and click “Show all” to see everything.</p>

        <div class="row">
          <nav class="tabs" aria-label="File di codice"></nav>
          <div class="row" style="margin-left:auto">
            <button class="btn" id="toggleBtn" type="button" hidden>Show all</button>
            <button class="btn" id="copyBtn"   type="button">Copy</button>
            <a class="btn" id="downloadBtn" href="#" download>Download</a>
          </div>
        </div>

        <div class="viewer" role="region" aria-live="polite" aria-label="Anteprima codice" data-collapsed="true">
          <pre id="codeArea"># Seleziona un file sopra per caricare l'anteprima…</pre>
        </div>
      </article>

      <!-- Presentation -->
      <article class="card">
        <h3>Presentation</h3>
        <p class="muted">Use the buttons at the bottom to view the full document.</p>
        <div class="pdf">
          <iframe src="../assets/presentazioni/itadatahack-2025.pdf#page=1&view=FitH" title="Presentazione"></iframe>
        </div>
        <div class="row" style="margin-top:10px">
          <a class="link" href="../assets/presentazioni/itadatahack-2025.pdf" target="_blank" rel="noreferrer">Full screen</a>
          <a class="link" href="../assets/presentazioni/itadatahack-2025.pdf" download>Download PDF</a>
        </div>
      </article>
    </div>
  </section>
</main>

<script>
(() => {
  const root = document.getElementById('codeViewer'); if(!root) return;
  const q = new URLSearchParams(location.search), hash = location.hash;
  const FORCE_FULL = q.get('full')==='1' || q.get('view')==='full' || hash==='#full';
  const PREVIEW_LINES = Math.max(1, parseInt(q.get('lines')||'4', 10));

  const files = JSON.parse(root.dataset.files || '[]');
  const tabs = root.querySelector('.tabs');
  const codeEl = root.querySelector('#codeArea');
  const viewer = root.querySelector('.viewer');
  const copyBtn = root.querySelector('#copyBtn');
  const toggleBtn = root.querySelector('#toggleBtn');
  const downloadBtn = root.querySelector('#downloadBtn');

  let rawText = '', isCollapsed = !FORCE_FULL;

  const render = () => {
    const lines = rawText.split('\n');
    const hasMore = lines.length > PREVIEW_LINES;
    codeEl.textContent = (isCollapsed && hasMore) ? lines.slice(0, PREVIEW_LINES).join('\n') : rawText;
    viewer.dataset.collapsed = (isCollapsed && hasMore) ? 'true' : 'false';
    toggleBtn.hidden = !hasMore;
    toggleBtn.textContent = isCollapsed ? 'Show all' : 'Show less';
    codeEl.style.maxHeight = (isCollapsed && hasMore) ? '220px' : '600px';
  };

  const load = async (src) => {
    codeEl.textContent = '# Caricamento…'; rawText = ''; downloadBtn.removeAttribute('href');
    try{
      const r = await fetch(src,{cache:'no-store'}); if(!r.ok) throw 0;
      rawText = await r.text(); downloadBtn.href = src; render();
    }catch{ codeEl.textContent = '# Impossibile caricare: '+src; viewer.dataset.collapsed='false'; toggleBtn.hidden=true; }
  };

  // build tabs
  tabs.innerHTML = files.map((f,i)=>`<button class="tab btn" type="button" data-i="${i}" aria-selected="${i? 'false':'true'}">${f.label}</button>`).join('');
  const setActive = (i)=> tabs.querySelectorAll('.tab').forEach((b,k)=>b.setAttribute('aria-selected', k===i? 'true':'false'));

  tabs.addEventListener('click', e=>{
    const b = e.target.closest('.tab'); if(!b) return;
    const i = +b.dataset.i; setActive(i); isCollapsed = !FORCE_FULL; load(files[i].src);
  });

  if(files[0]) load(files[0].src); else { codeEl.textContent = '# Nessun file configurato.'; viewer.dataset.collapsed='false'; }

  copyBtn.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(rawText||''); }catch{} });
  toggleBtn.addEventListener('click', ()=>{ isCollapsed=!isCollapsed; render(); });

  const initCollapsed = isCollapsed;
  addEventListener('beforeprint', ()=>{ isCollapsed=false; render(); });
  addEventListener('afterprint',  ()=>{ isCollapsed=initCollapsed; render(); });
})();
</script>
</body>
</html>
