<!doctype html>
<html lang="it">
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Test anteprima codice</title>
<style>
  :root{--bg:#f7f8fb;--panel:#fff;--text:#0f172a;--muted:#334155;--ring-soft:rgba(29,78,216,.12);--shadow-md:0 6px 18px rgba(2,6,23,.08),0 2px 8px rgba(2,6,23,.06)}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter;color:var(--text);background:var(--bg)}
  .container{max-width:900px;margin:30px auto;padding:20px}
  .card{background:var(--panel);border:1px solid rgba(15,23,42,.06);border-radius:16px;box-shadow:var(--shadow-md);padding:16px}
  .tabs{display:flex;gap:8px;margin-bottom:8px}
  .tab{border:1px solid rgba(15,23,42,.1);border-radius:999px;padding:8px 12px;background:#fff;font-weight:600}
  .toolbar{display:flex;gap:8px;margin-left:auto}
  .btn{border:1px solid rgba(15,23,42,.1);border-radius:999px;padding:8px 10px;background:#fff;font-weight:600}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .viewer{position:relative;border:1px solid rgba(15,23,42,.06);border-radius:16px;overflow:hidden;background:#0b1020}
  .viewer pre{margin:0;padding:16px 18px;overflow:auto;color:#e6e6e6;font:13px/1.5 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;counter-reset:line;transition:max-height .28s ease}
  .viewer code>span{display:block;counter-increment:line}
  .viewer code>span::before{content:counter(line);display:inline-block;width:2.4em;margin-right:.8em;color:#7c869b;text-align:right}
  .kw{color:#93c5fd}.fn{color:#a7f3d0}.cm{color:#9ca3af}.st{color:#fde68a}
  .viewer[data-collapsed="true"]::after{content:"";position:absolute;left:0;right:0;bottom:0;height:56px;background:linear-gradient(to bottom,rgba(11,16,32,0),rgba(11,16,32,.88));pointer-events:none}
</style>
<body>
  <div class="container">
    <div class="card">
      <h3>Codici</h3>
      <div class="row">
        <nav class="tabs"><button class="tab" id="fakeTab">example.py</button></nav>
        <div class="toolbar">
          <button class="btn" id="toggleBtn">Mostra tutto</button>
          <button class="btn" id="copyBtn">Copia</button>
        </div>
      </div>
      <div class="viewer" data-collapsed="true"><pre><code id="codeArea"></code></pre></div>
    </div>
  </div>
<script>
  const PREVIEW_LINES=4;
  const codeArea=document.getElementById('codeArea');
  const viewer=document.querySelector('.viewer');
  const toggleBtn=document.getElementById('toggleBtn');
  const copyBtn=document.getElementById('copyBtn');

  const RAW=`import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.ensemble import RandomForestClassifier
from imblearn.metrics import geometric_mean_score

train = pd.read_csv("training_categoria.csv", sep=";")
test  = pd.read_csv("test_categoria.csv", sep=";")
X = train.drop(columns=["TRACE_ID","ANOMALY_CATEGORY"])
y = train["ANOMALY_CATEGORY"]
`;

  function lineize(t){
    const esc=s=>s.replace(/[&<>]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
    let out=esc(t)
      .replace(/^(\s*#.*)$/gm,'<span class="cm">$1</span>')
      .replace(/("[^"]*"|'[^']*')/g,'<span class="st">$1</span>')
      .replace(/\b(def|class|import|from|return|for|while|if|elif|else|with|as|try|except|finally|yield|lambda|pass|break|continue|in|not|and|or)\b/g,'<span class="kw">$1</span>')
      .replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g,'<span class="fn">$1</span>');
    return out.split('\n').map(l=>`<span>${l||' '}</span>`).join('\n');
  }

  let rawText=RAW, isCollapsed=true;
  function render(){
    const lines=rawText.split('\n');
    const hasMore=lines.length>PREVIEW_LINES;
    const shown=isCollapsed&&hasMore?lines.slice(0,PREVIEW_LINES):lines;
    codeArea.innerHTML=lineize(shown.join('\n'));
    viewer.dataset.collapsed=(isCollapsed&&hasMore)?"true":"false";
    toggleBtn.style.display=hasMore?'inline-block':'none';
    toggleBtn.textContent=isCollapsed?'Mostra tutto':'Mostra meno';
    const lineHeight=20, padding=32;
    const targetH=(isCollapsed&&hasMore?PREVIEW_LINES:lines.length)*lineHeight+padding;
    viewer.querySelector('pre').style.maxHeight=Math.min(targetH,600)+'px';
  }
  render();

  toggleBtn.onclick=()=>{ isCollapsed=!isCollapsed; render(); };
  copyBtn.onclick=async()=>{
    await navigator.clipboard.writeText(rawText);
    copyBtn.textContent='Copiato!'; setTimeout(()=>copyBtn.textContent='Copia',1000);
  };
</script>
</body>
</html>
