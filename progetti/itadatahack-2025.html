<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Anteprima codice (semplice)</title>
  <style>
    body { margin:0; font-family:system-ui, Arial, sans-serif; background:#f5f5f7; color:#111; }
    .container { max-width:800px; margin:0 auto; padding:16px; }
    h1 { margin:0 0 12px; }
    .box { background:#fff; border:1px solid #ddd; border-radius:10px; padding:12px; }

    /* Viewer semplice con <details> */
    details.viewer { border:1px solid #ddd; border-radius:8px; background:#0b1020; color:#eee; }
    details.viewer summary { padding:8px 12px; cursor:pointer; }
    details.viewer summary::-webkit-details-marker { display:none; }
    details.viewer pre {
      margin:0; padding:12px;
      font:13px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      white-space:pre-wrap; word-break:break-word; overflow:auto;
    }
    /* Anteprima “ridotta” quando CHIUSO */
    details.viewer:not([open]) pre { max-height:220px; }

    .toolbar { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px; }
    .btn, .link {
      padding:8px 10px; border:1px solid #ddd; background:#fff; border-radius:999px;
      cursor:pointer; color:#111; text-decoration:none; display:inline-block;
    }
  </style>
</head>
<body>
  <main class="container">
    <h1>Codice: Task 1.py</h1>

    <section class="box" id="codeBox" data-src="../assets/codici/Task 1.py">
      <div class="toolbar">
        <button class="btn" id="copyBtn" type="button">Copia</button>
        <a class="btn" id="downloadBtn" href="#" download>Download</a>
      </div>

      <!-- Anteprima/Completo con <details> -->
      <details class="viewer" id="viewer" open>
        <summary>
          <span class="txt-more">Mostra meno</span>
        </summary>
        <pre id="codeArea"># Caricamento…</pre>
      </details>
    </section>
  </main>

  <script>
  (function () {
    const box = document.getElementById('codeBox');
    const src = box?.dataset?.src || '';
    const pre = document.getElementById('codeArea');
    const viewer = document.getElementById('viewer');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const summaryText = viewer.querySelector('.txt-more');

    let rawText = '';

    // Testo del summary in base allo stato (aperto = tutto visibile)
    function updateSummary() {
      summaryText.textContent = viewer.open ? 'Mostra meno' : 'Mostra tutto';
    }
    viewer.addEventListener('toggle', updateSummary);

    async function load() {
      if (!src) {
        pre.textContent = '# Nessun file configurato.';
        viewer.open = true;
        updateSummary();
        return;
      }
      pre.textContent = '# Caricamento…';
      downloadBtn.removeAttribute('href');
      try {
        const r = await fetch(src, { cache: 'no-store' });
        if (!r.ok) throw new Error(r.statusText);
        rawText = await r.text();
        pre.textContent = rawText;
        downloadBtn.href = src;
      } catch (e) {
        pre.textContent = '# Impossibile caricare: ' + src + '\n# Controlla il percorso o il nome del file.';
        viewer.open = true;
      }
      updateSummary();
    }

    // Copia tutto il file
    copyBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(rawText || ''); } catch (e) {}
    });

    // Durante la stampa mostra sempre tutto
    let wasOpen = viewer.open;
    window.addEventListener('beforeprint', () => { wasOpen = viewer.open; viewer.open = true; });
    window.addEventListener('afterprint', () => { viewer.open = wasOpen; });

    load();
  })();
  </script>
</body>
</html>
